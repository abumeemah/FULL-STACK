# Ficore Budget Mobile Backend

A Flask-based REST API backend specifically designed for the Ficore Budget Mobile App. This backend provides all the necessary endpoints for user authentication, budget management, expense tracking, and credits management.

## üöÄ Features

- **Complete Authentication System** - Login, signup, password reset, JWT tokens
- **User Management** - Profile management, settings, account operations
- **Budget Management** - CRUD operations, analytics, dashboard data
- **Expense Tracking** - Transaction recording, categorization, statistics
- **Credits Management** - Balance tracking, top-up requests, transaction history
- **Admin Panel** - User management, credit request approval
- **File Uploads** - Profile pictures and receipt uploads
- **Dark/Light Mode Support** - API responses optimized for both themes

## üìã API Endpoints

### Authentication
- `POST /auth/login` - User login
- `POST /auth/signup` - User registration
- `POST /auth/logout` - User logout
- `POST /auth/refresh` - Refresh JWT token
- `POST /auth/forgot-password` - Request password reset
- `POST /auth/reset-password` - Reset password with token

### User Management
- `GET /users/profile` - Get user profile
- `PUT /users/profile` - Update user profile
- `POST /users/setup` - Complete profile setup
- `POST /users/change-password` - Change password
- `DELETE /users/delete` - Delete account
- `GET /users/settings` - Get user settings
- `PUT /users/settings` - Update user settings

### Budget Management
- `GET /budget/budgets` - Get budgets with pagination
- `GET /budget/budgets/{id}` - Get specific budget
- `POST /budget/new` - Create new budget
- `PUT /budget/budgets/{id}` - Update budget
- `DELETE /budget/budgets/{id}` - Delete budget
- `GET /budget/dashboard` - Get budget dashboard data
- `GET /budget/statistics` - Get budget statistics
- `GET /budget/recent` - Get recent budgets

### Expense Tracking
- `GET /tracking` - Get expenses with filtering
- `POST /tracking` - Create new expense
- `PUT /tracking/expense/{id}` - Update expense
- `DELETE /tracking/expense/{id}` - Delete expense
- `GET /tracking/statistics` - Get expense statistics
- `GET /tracking/summary` - Get expense summary
- `GET /tracking/history/{type}` - Get expense history

### Credits Management
- `GET /credits/balance` - Get credit balance
- `GET /credits/history` - Get credit transaction history
- `POST /credits/request` - Submit credit top-up request
- `PUT /credits/request/{id}` - Update credit request

### File Uploads
- `POST /upload/profile-picture` - Upload profile picture

### Admin (Admin users only)
- `GET /admin/users` - Get all users
- `GET /admin/credit-requests` - Get credit requests
- `POST /admin/credit-requests/{id}/approve` - Approve credit request
- `POST /admin/credit-requests/{id}/deny` - Deny credit request

### Health Check
- `GET /` - API information
- `GET /health` - Health check endpoint

## üõ† Installation & Setup

### Local Development

1. **Clone the repository**
```bash
git clone <repository-url>
cd ficore_mobile_backend
```

2. **Create virtual environment**
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. **Install dependencies**
```bash
pip install -r requirements.txt
```

4. **Set environment variables**
Create a `.env` file:
```env
SECRET_KEY=your-secret-key-here
MONGO_URI=mongodb://localhost:27017/ficore_mobile
FLASK_ENV=development
```

5. **Run the application**
```bash
python app.py
```

The API will be available at `http://localhost:5000`

### MongoDB Setup

You can use either local MongoDB or MongoDB Atlas:

#### Local MongoDB
```bash
# Install MongoDB locally
# Start MongoDB service
mongod

# The default connection string is:
# mongodb://localhost:27017/ficore_mobile
```

#### MongoDB Atlas (Recommended for production)
1. Create a MongoDB Atlas account
2. Create a new cluster
3. Create a database user
4. Get the connection string
5. Update MONGO_URI in your environment variables

## üöÄ Deployment to Render

### Automatic Deployment

1. **Push to GitHub**
```bash
git add .
git commit -m "Initial commit"
git push origin main
```

2. **Connect to Render**
- Go to [Render Dashboard](https://dashboard.render.com)
- Click "New +" ‚Üí "Web Service"
- Connect your GitHub repository
- Select the `ficore_mobile_backend` folder

3. **Configure Environment Variables**
Set these environment variables in Render:
```
SECRET_KEY=<auto-generated-by-render>
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/ficore_mobile
FLASK_ENV=production
```

4. **Deploy**
Render will automatically build and deploy your application.

### Manual Deployment Configuration

The repository includes:
- `render.yaml` - Render service configuration
- `Procfile` - Process configuration
- `requirements.txt` - Python dependencies

## üìä Database Schema

### Users Collection
```javascript
{
  _id: ObjectId,
  email: String,
  password: String (hashed),
  firstName: String,
  lastName: String,
  displayName: String,
  phone: String,
  address: String,
  dateOfBirth: String,
  role: String, // 'personal' or 'admin'
  ficoreCreditBalance: Number,
  setupComplete: Boolean,
  isActive: Boolean,
  settings: Object,
  createdAt: Date,
  lastLogin: Date
}
```

### Budgets Collection
```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  name: String,
  description: String,
  income: Number,
  categories: Array,
  totalAllocated: Number,
  totalSpent: Number,
  surplusDeficit: Number,
  period: String,
  startDate: Date,
  endDate: Date,
  status: String,
  createdAt: Date,
  updatedAt: Date
}
```

### Expenses Collection
```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  title: String,
  amount: Number,
  category: String,
  description: String,
  date: Date,
  paymentMethod: String,
  tags: Array,
  receiptUrl: String,
  createdAt: Date,
  updatedAt: Date
}
```

### Credit Requests Collection
```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  amount: Number,
  paymentMethod: String,
  paymentReference: String,
  receiptUrl: String,
  notes: String,
  status: String, // 'pending', 'approved', 'denied'
  adminNotes: String,
  approvedBy: ObjectId,
  createdAt: Date,
  updatedAt: Date
}
```

### Credit Transactions Collection
```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  type: String, // 'credit' or 'debit'
  amount: Number,
  description: String,
  reference: String,
  requestId: ObjectId,
  createdAt: Date
}
```

## üîê Authentication & Security

### JWT Token Authentication
- Access tokens expire in 24 hours
- Refresh tokens expire in 30 days
- Tokens are required for all protected endpoints
- Include token in Authorization header: `Bearer <token>`

### Password Security
- Passwords are hashed using Werkzeug's security functions
- Minimum password length: 6 characters
- Password reset tokens expire in 1 hour

### CORS Configuration
- Configured to allow requests from mobile apps
- Supports all necessary HTTP methods
- Includes proper headers for mobile compatibility

## üì± Mobile App Integration

### Request Format
All requests should include:
```
Content-Type: application/json
Authorization: Bearer <jwt_token> (for protected endpoints)
```

### Response Format
All responses follow this structure:
```json
{
  "success": true/false,
  "data": { ... },
  "message": "Description of the result",
  "errors": { "field": ["error message"] } // Only on errors
}
```

### Error Handling
- 400: Bad Request (validation errors)
- 401: Unauthorized (invalid/missing token)
- 403: Forbidden (insufficient permissions)
- 404: Not Found (resource doesn't exist)
- 500: Internal Server Error

## üß™ Testing

### Test User Accounts
The API supports creating test accounts. You can create admin users by setting the role to 'admin' in the database.

### API Testing
Use tools like Postman or curl to test endpoints:

```bash
# Health check
curl https://your-api-url.onrender.com/health

# Login
curl -X POST https://your-api-url.onrender.com/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "password123"}'

# Get profile (with token)
curl -X GET https://your-api-url.onrender.com/users/profile \
  -H "Authorization: Bearer <your-jwt-token>"
```

## üìà Performance & Scalability

### Database Indexing
Recommended indexes for better performance:
```javascript
// Users collection
db.users.createIndex({ "email": 1 }, { unique: true })
db.users.createIndex({ "isActive": 1 })

// Budgets collection
db.budgets.createIndex({ "userId": 1, "status": 1 })
db.budgets.createIndex({ "createdAt": -1 })

// Expenses collection
db.expenses.createIndex({ "userId": 1, "date": -1 })
db.expenses.createIndex({ "userId": 1, "category": 1 })

// Credit requests collection
db.credit_requests.createIndex({ "userId": 1, "status": 1 })
db.credit_requests.createIndex({ "status": 1, "createdAt": -1 })
```

### Caching
Consider implementing Redis caching for:
- User sessions
- Frequently accessed budget data
- Dashboard statistics

## üîß Configuration

### Environment Variables
- `SECRET_KEY`: JWT signing key (auto-generated in production)
- `MONGO_URI`: MongoDB connection string
- `FLASK_ENV`: Environment (development/production)
- `PORT`: Server port (set by Render)

### Feature Flags
You can add feature flags to enable/disable certain functionality:
- File upload limits
- Credit request limits
- Admin features
- Debug logging

## üìû Support

For issues or questions:
1. Check the API health endpoint: `/health`
2. Review the logs in Render dashboard
3. Test individual endpoints with proper authentication
4. Verify MongoDB connection and data

## üöÄ Deployment URL

Once deployed to Render, your API will be available at:
`https://ficore-mobile-backend.onrender.com`

Update your mobile app's API base URL to point to this endpoint.

---

**The backend is now ready to support your Ficore Budget Mobile App with all required functionality!**